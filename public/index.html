<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SOLIS è¨±é¡˜ç‰†</title>

  <style>
    :root{
      --bg:#f7f7f7;
      --text:#111;
      --muted:#666;
      --card:#fff;
      --orange:#ff6a00;
      --shadow: 0 10px 24px rgba(0,0,0,0.06);
    }

    *{ box-sizing: border-box; }

    body{
      font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg);
      color: var(--text);
    }

    .brand{ text-align:center; margin-bottom:10px; }
    .brand img{ max-height: 180px; } /* ä½ ä¹‹å‰èªª 180px OK */

    h1{
      margin: 10px 0 6px;
      text-align:center;
      font-size: 44px;
      letter-spacing: .5px;
    }

    .hint{
      color: #444;
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 22px;
      letter-spacing: 0.6px;
    }

    /* ===== ç‰ˆé¢ï¼šwall/host æ‰å•Ÿç”¨ã€Œå½±ç‰‡å€ + äº’å‹•ç‰†ã€é›™æ¬„ ===== */
    .stage{
      max-width: 1280px;
      margin: 0 auto;
      display: grid;
      gap: 18px;
    }
    /* é è¨­ï¼ˆä¾†è³“ä¸€èˆ¬é ï¼‰å–®æ¬„ */
    .stage{ grid-template-columns: 1fr; }

    /* wall æˆ– host æ‰æ”¹é›™æ¬„ï¼ˆå·¦ï¼šç›´å¼å½±ç‰‡ã€å³ï¼šäº’å‹•ç‰†ï¼‰ */
body.has-media .stage{
  grid-template-columns: 1fr 360px;  /* âœ… å·¦ç•™è¨€ å³å½±ç‰‡ */
  align-items: start;
}


    /* æ‰‹æ©Ÿæˆ–çª„è¢å¹•ï¼šæ”¹æˆä¸Šä¸‹æ’åˆ—ï¼Œé¿å…å¤ªæ“  */
    @media (max-width: 980px){
      body.has-media .stage{
        grid-template-columns: 1fr;
      }
      .media-slot{ width: min(420px, 92vw); margin: 0 auto; }
    }

    .wrap{ max-width: 1100px; margin: 0 auto; }

    /* ===== ç›´å¼å½±ç‰‡å€ï¼ˆ19.5:9ï¼‰===== */
.media-slot{
  width: 360px;              /* ä½ å¯ä¾ç¾å ´è¢å¹•æ”¹ 320~420 */
  aspect-ratio: 9 / 16;      /* âœ… ç›´å¼ 9:16 */
  background:#000;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 18px 44px rgba(0,0,0,0.18);
  position: sticky;
  top: 20px;
}


    .media-slot video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      background:#000;
    }

    /* æ²’æœ‰å½±ç‰‡æ™‚çš„å°é¢ï¼ˆå¯æ”¾ LOGO / æ–‡å­—ï¼‰ */
    .media-fallback{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      color: rgba(255,255,255,0.86);
      text-align:center;
      font-weight: 900;
      letter-spacing: 1px;
      line-height: 1.35;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,106,0,0.35), transparent 40%),
        radial-gradient(circle at 70% 80%, rgba(255,255,255,0.08), transparent 45%),
        #0b0b0b;
    }

    /* ===== è¼¸å…¥å€ ===== */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 18px;
    }
    input, button{
      font-size: 18px;
      padding: 14px 16px;
      border-radius: 12px;
    }
    input{ border:1px solid #ccc; }
    button{
      background:#111;
      color:#fff;
      border:none;
      cursor:pointer;
    }
    button:hover{ opacity:.92; }

    /* wallï¼šéš±è—è¼¸å…¥ */
    .wall-only .input-area{ display:none; }

    /* ===== ç•™è¨€ç‰† ===== */
    .wall{
      margin-top: 24px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
    }
    .item{ margin-bottom: 18px; }

    .line{
      background: var(--card);
      border-radius: 18px;
      padding: 18px 22px;
      box-shadow: var(--shadow);
      display:flex;
      gap: 12px;
      align-items: baseline;
      flex-wrap: wrap;
    }
    .line .name{
      font-size: 22px;
      font-weight: 900;
      color: var(--text);
    }
    .line .time{
      font-size: 16px;
      color: #777;
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }
    .line .msg{
      font-size: 30px;
      font-weight: 800;
      line-height: 1.25;
      color: var(--text);
      word-break: break-word;
    }

    /* æ–°ç•™è¨€å‹•ç•« */
    @keyframes popIn{
      0%{ transform: translateY(12px) scale(.96); opacity:0; }
      60%{ transform: translateY(0) scale(1.03); opacity:1; }
      100%{ transform: translateY(0) scale(1); opacity:1; }
    }
    @keyframes glow{
      0%{ box-shadow: var(--shadow); }
      40%{ box-shadow: 0 18px 42px rgba(255,106,0,0.25); }
      100%{ box-shadow: var(--shadow); }
    }
    .item.is-new .line{
      animation: popIn 420ms ease-out, glow 1200ms ease-out;
      outline: 3px solid rgba(255,106,0,0.22);
    }

    /* ===== QRï¼ˆwall=1 æˆ– host=1 é¡¯ç¤ºï¼‰===== */
    .qr-box{
      position: fixed;
      left: 24px;
      top: 24px;
      background:#fff;
      padding: 14px;
      border-radius: 18px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.18);
      text-align:center;
      z-index: 999;
      display:none;
    }
    .qr-text{
      margin-top: 10px;
      font-size: 20px;
      font-weight: 900;
      color: var(--orange);
      letter-spacing: 1px;
      animation: qrBreath 1.6s ease-in-out infinite;
    }
    @keyframes qrBreath{
      0%,100%{ opacity: 1; }
      50%{ opacity: 0.75; }
    }

    /* ===== ä¸»æŒäººæ‡¸æµ®æ§åˆ¶å¡ï¼ˆå³ä¸Šï¼‰===== */
    .host-card{
      position: fixed;
      top: 24px;
      right: 24px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(8px);
      border-radius: 18px;
      padding: 12px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      display: inline-flex;
      flex-direction: column;
      gap: 8px;
      z-index: 998;
      align-items: center;
    }

    /* åªæœ‰ host=1 æ‰é¡¯ç¤ºæŒ‰éˆ• */
    #hostActions{ display:none; }
    body.is-host #hostActions{ display:flex; }

    .host-actions{
      display:flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-draw{
      background: linear-gradient(135deg, #ff7a00, #ff9a3c);
      color: #fff;
      font-size: 16px;
      font-weight: 900;
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      cursor: pointer;
      box-shadow: 0 6px 16px rgba(255,122,0,0.35);
    }
    .btn-draw:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(255,122,0,0.45);
    }

    .btn-ghost{
      background: #fff;
      color: #111;
      font-size: 14px;
      font-weight: 800;
      border: 1px solid #ddd;
      border-radius: 999px;
      padding: 10px 14px;
      cursor: pointer;
    }
    .btn-ghost:hover{ background:#f3f3f3; }

    .host-info{
      font-size: 14px;
      color: #555;
      text-align: center;
      width: 100%;
      transform-origin: center;
    }

    /* äººæ•¸å¢åŠ é–ƒä¸€ä¸‹ */
    @keyframes countFlash {
      0% { color: var(--orange); transform: scale(1); }
      40%{ color: var(--orange); transform: scale(1.15); }
      100%{ color: #555; transform: scale(1); }
    }
    .host-info.flash{ animation: countFlash 600ms ease-out; }

    /* ===== æŠ½ç overlay ===== */
    .draw-overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .draw-box{
      width: min(920px, 94vw);
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.35);
      padding: 26px 26px 22px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .confetti{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:.85;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,106,0,.55), transparent 30%),
        radial-gradient(circle at 80% 10%, rgba(0,0,0,.15), transparent 25%),
        radial-gradient(circle at 90% 70%, rgba(255,106,0,.35), transparent 28%),
        radial-gradient(circle at 30% 80%, rgba(0,0,0,.08), transparent 25%);
      mix-blend-mode: multiply;
      transform: scale(1.1);
    }
    .draw-close{
      position:absolute;
      right: 18px;
      top: 14px;
      border:none;
      background: transparent;
      font-size: 22px;
      cursor: pointer;
      color: #666;
    }
    .draw-title{
      font-size: 18px;
      color: #666;
      margin-bottom: 12px;
      font-weight: 900;
      letter-spacing: 1px;
    }
    .draw-name{
      font-size: clamp(42px, 6vw, 86px);
      font-weight: 1000;
      margin: 6px 0 8px;
      color: #111;
    }
    .draw-sub{
      font-size: 16px;
      color: #777;
      margin-top: 10px;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      35%{ transform: scale(1.03); }
      100%{ transform: scale(1); }
    }
    .win{ animation: pulse 900ms ease-out 1; }

    /* æŠ½ 3 åé€ä¸€æ­æ›‰ */
    .draw-list{
      margin-top: 10px;
      display: none;
      gap: 14px;
      justify-items: center;
    }
    .draw-pill{
      width: min(640px, 92%);
      background: #fff;
      border-radius: 18px;
      padding: 16px 18px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
      display:flex;
      align-items: baseline;
      gap: 14px;
      opacity: 0;
      transform: translateY(10px) scale(.98);
    }
    .draw-rank{
      font-weight: 1000;
      font-size: 18px;
      color: var(--orange);
      letter-spacing: 1px;
      white-space: nowrap;
    }
    .draw-winner{
      font-weight: 1000;
      font-size: clamp(28px, 3.6vw, 44px);
      color:#111;
      word-break: break-word;
    }
    @keyframes revealIn{
      0% { opacity:0; transform: translateY(14px) scale(.97); }
      60%{ opacity:1; transform: translateY(0) scale(1.02); }
      100%{ opacity:1; transform: translateY(0) scale(1); }
    }
    .draw-pill.show{ animation: revealIn 520ms ease-out forwards; }
  </style>
</head>

<body>
  <div class="brand">
    <img src="logo.png" alt="SOLIS">
  </div>

  <!-- ä¸»æŒäººæ§åˆ¶å¡ï¼ˆå³ä¸Šè§’ï¼‰ -->
  <div class="host-card" id="hostCard">
    <div class="host-actions" id="hostActions">
  <button class="btn-draw" id="draw3Btn">ğŸ‰ æŠ½ 3 å</button>

  <!-- âœ… æ–°å¢ï¼šé¸å½±ç‰‡ -->
  <input id="pickVideo" type="file" accept="video/*" style="display:none;">
  <button class="btn-ghost" id="pickVideoBtn">ğŸ“ é¸å½±ç‰‡</button>

  <button class="btn-ghost" id="vidPlay">â–¶ï¸ æ’­æ”¾</button>
  <button class="btn-ghost" id="vidPause">â¸ æš«åœ</button>
  <button class="btn-ghost" id="vidMute">ğŸ”‡ éœéŸ³</button>
  <button class="btn-ghost" id="vidNext">â­ ä¸‹ä¸€æ”¯</button>
</div>

    <div class="host-info" id="playerCount">åƒèˆ‡è€…ï¼š0 äºº</div>
  </div>

  <div class="stage">

  <!-- âœ… å·¦ï¼šäº’å‹•ç‰†å…§å®¹ -->
  <div class="wrap">
    ...
  </div>

  <!-- âœ… å³ï¼šç›´å¼å½±ç‰‡ï¼ˆåªåœ¨ wall/host é¡¯ç¤ºï¼‰ -->
  <div class="media-slot" id="mediaSlot" style="display:none;">
    <video id="bgVideo" playsinline preload="metadata"></video>
    <div class="media-fallback" id="mediaFallback" style="display:none;">
      SOLIS æ´»å‹•ç¾å ´<br/>æ’­æ”¾å€
    </div>
  </div>

</div>

  <!-- QRï¼ˆwall=1 æˆ– host=1 é¡¯ç¤ºï¼‰ -->
  <div class="qr-box" id="qrBox">
    <canvas id="qr"></canvas>
    <div class="qr-text">æƒæåƒåŠ æŠ½ç</div>
  </div>

  <!-- æŠ½ç overlayï¼ˆä¸»æŒäººè§¸ç™¼ï¼‰ -->
  <div class="draw-overlay" id="drawOverlay">
    <div class="draw-box" id="drawBox">
      <div class="confetti"></div>
      <button class="draw-close" id="drawClose" aria-label="Close">âœ•</button>
      <div class="draw-title">WINNERS</div>
      <div class="draw-name" id="drawName">æº–å‚™æŠ½çâ€¦</div>
      <div class="draw-list" id="drawList"></div>
      <div class="draw-sub" id="drawSub"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

  <script>
    // ===== è§£æç¶²å€åƒæ•¸ =====
    const params = new URLSearchParams(window.location.search);
    const isWall = params.get("wall") === "1";
    const isHost = params.get("host") === "1";

    if (isWall) document.body.classList.add("wall-only");
    if (isHost) document.body.classList.add("is-host");

    // wall æˆ– host æ‰é¡¯ç¤ºå½±ç‰‡å€
    const hasMedia = (isWall || isHost);
    if (hasMedia) document.body.classList.add("has-media");

    // ===== Socket.IO =====
    const socket = io();

    const wall = document.getElementById("wall");
    const nameEl = document.getElementById("name");
    const msgEl = document.getElementById("message");
    const btn = document.getElementById("send");

    const playerCountEl = document.getElementById("playerCount");
    const draw3Btn = document.getElementById("draw3Btn");

    const drawOverlay = document.getElementById("drawOverlay");
    const drawBox = document.getElementById("drawBox");
    const drawName = document.getElementById("drawName");
    const drawSub = document.getElementById("drawSub");
    const drawClose = document.getElementById("drawClose");
    const drawList = document.getElementById("drawList");

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[s]));
    }

    function now() {
      const d = new Date();
      const pad = n => String(n).padStart(2,"0");
      return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    }

    // ===== tokenï¼šåŒè£ç½®å›ºå®š =====
    let myToken = localStorage.getItem("event_token");
    if (!myToken) {
      myToken = (crypto?.randomUUID?.() || (Date.now() + "-" + Math.random())).toString();
      localStorage.setItem("event_token", myToken);
    }

    // ===== é–åå­—ï¼ˆåŒè£ç½®ï¼‰=====
    const lockedName = localStorage.getItem("event_name");
    if (lockedName) {
      nameEl.value = lockedName;
      nameEl.disabled = true;
    }

    // ===== é˜²é€£é»é€å‡º =====
    let sending = false;
    function sendCheckin(){
      if (sending) return;
      sending = true;
      setTimeout(() => (sending = false), 650);

      const name = nameEl.value.trim();
      const message = msgEl.value.trim() || "æˆ‘å·²ç°½åˆ°";
      if (!name) { alert("è«‹å…ˆè¼¸å…¥åå­—"); return; }

      if (!localStorage.getItem("event_name")) {
        localStorage.setItem("event_name", name);
        nameEl.disabled = true;
      }

      socket.emit("checkin", { token: myToken, name, message, time: now() });
      msgEl.value = "";
      msgEl.focus();
    }
    btn.addEventListener("click", sendCheckin);
    msgEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendCheckin();
      }
    });

    // ===== å³æ™‚ç‰† =====
    socket.on("wall", (p) => {
      const div = document.createElement("div");
      div.className = "item is-new";
      div.innerHTML = `
        <div class="line">
          <span class="name">${escapeHtml(p.name)}</span>
          <span class="time">${escapeHtml(p.time)}ï¼š</span>
          <span class="msg">${escapeHtml(p.message)}</span>
        </div>
      `;
      wall.prepend(div);

      setTimeout(() => div.classList.remove("is-new"), 1800);
      while (wall.children.length > 50) wall.removeChild(wall.lastChild);
    });

    // ===== åƒèˆ‡è€…äººæ•¸ï¼ˆäººæ•¸è®Šå¤šæ‰é–ƒï¼‰=====
    let lastCount = 0;
    socket.on("participants_count", (d) => {
      const c = Number(d?.count ?? 0);
      if (!playerCountEl) return;

      playerCountEl.textContent = `åƒèˆ‡è€…ï¼š${c} äºº`;

      if (c > lastCount) {
        playerCountEl.classList.remove("flash");
        void playerCountEl.offsetWidth;
        playerCountEl.classList.add("flash");
      }
      lastCount = c;
    });

    // ===== QRï¼šwall æˆ– host é¡¯ç¤ºï¼ˆæƒåˆ°é¦–é ï¼Œä¸å¸¶ hostï¼‰=====
    if (isWall || isHost) {
      const qrBox = document.getElementById("qrBox");
      if (qrBox) qrBox.style.display = "block";
      new QRious({
        element: document.getElementById("qr"),
        value: window.location.origin,
        size: 180
      });
    }

    // ===== æŠ½ç Overlay æ§åˆ¶ =====
    function openDrawOverlay(){
      drawOverlay.style.display = "flex";
      drawName.style.display = "block";
      drawName.textContent = "æŠ½çä¸­â€¦";
      drawSub.textContent = "";
      drawList.style.display = "none";
      drawList.innerHTML = "";
      drawBox.classList.remove("win");
    }
    function closeDrawOverlay(){
      drawOverlay.style.display = "none";
    }
    drawClose.addEventListener("click", closeDrawOverlay);
    drawOverlay.addEventListener("click", (e) => { if (e.target === drawOverlay) closeDrawOverlay(); });

    function rollingText(durationMs = 1200){
      const frames = ["æŠ½çä¸­", "æŠ½çä¸­.", "æŠ½çä¸­..", "æŠ½çä¸­..."];
      let i = 0;
      const t = setInterval(() => {
        if (drawOverlay.style.display !== "flex") { clearInterval(t); return; }
        drawName.textContent = frames[i % frames.length];
        i++;
      }, 140);
      setTimeout(() => clearInterval(t), durationMs);
    }

    // ä¸»æŒäººï¼šæŠ½ 3 åï¼ˆå‘¼å« serverï¼‰
    if (isHost && draw3Btn) {
      draw3Btn.addEventListener("click", () => {
        openDrawOverlay();
        rollingText(1200);
        socket.emit("host_draw", { n: 3 });
      });
    }

    // æŠ½ççµæœï¼šé€ä¸€æ­æ›‰ 3 ä½
    socket.on("draw_result", (r) => {
      if (!isHost) return;

      const winners = Array.isArray(r?.winners) ? r.winners : (r?.winner ? [r.winner] : []);
      openDrawOverlay();

      if (!r?.ok || winners.length === 0) {
        drawName.textContent = r?.reason || "æŠ½çå¤±æ•—";
        drawSub.textContent = "";
        return;
      }

      drawSub.textContent = `åƒèˆ‡è€…å…± ${Number(r.total ?? winners.length)} äºº`;
      drawName.textContent = "æº–å‚™æ­æ›‰â€¦";

      setTimeout(() => {
        drawName.style.display = "none";
        drawList.style.display = "grid";
        drawList.innerHTML = "";

        winners.slice(0, 3).forEach((name, idx) => {
          const pill = document.createElement("div");
          pill.className = "draw-pill";
          pill.innerHTML = `
            <div class="draw-rank">ç¬¬ ${idx + 1} ä½</div>
            <div class="draw-winner">${escapeHtml(name)}</div>
          `;
          drawList.appendChild(pill);

          setTimeout(() => {
            pill.classList.add("show");
            drawBox.classList.remove("win");
            void drawBox.offsetWidth;
            drawBox.classList.add("win");
          }, idx * 700);
        });

        drawSub.textContent = "ğŸ‰ æ­å–œå¾—çï¼";
      }, 800);
    });

    // ===== ç›´å¼å½±ç‰‡ï¼šåªåœ¨ wall/host é¡¯ç¤º =====
    const mediaSlot = document.getElementById("mediaSlot");
    const bgVideo = document.getElementById("bgVideo");
    // ===== ä¸»æŒäººï¼šæœ¬æ©Ÿé¸å½±ç‰‡æ’­æ”¾ =====
const pickVideo = document.getElementById("pickVideo");
const pickVideoBtn = document.getElementById("pickVideoBtn");

if (isHost && pickVideo && pickVideoBtn && bgVideo) {

  // é»ã€Œé¸å½±ç‰‡ã€â†’ æ‰“é–‹ç³»çµ±æª”æ¡ˆé¸æ“‡å™¨
  pickVideoBtn.addEventListener("click", () => {
    pickVideo.click();
  });

  // é¸åˆ°å½±ç‰‡å¾Œç«‹å³æ’­æ”¾
  pickVideo.addEventListener("change", () => {
    const file = pickVideo.files?.[0];
    if (!file) return;

    const url = URL.createObjectURL(file);

    bgVideo.src = url;
    bgVideo.loop = true;      // æ´»å‹•æœ€ç©©ï¼šå¾ªç’°æ’­
    bgVideo.muted = true;    // âœ… å¿…é ˆéœéŸ³æ‰èƒ½è‡ªå‹•æ’­
    bgVideo.playsInline = true;

    bgVideo.play().catch(() => {});
  });
}

    const mediaFallback = document.getElementById("mediaFallback");

    // ä½ æŠŠå½±ç‰‡æ”¾åœ¨ public/media/ åº•ä¸‹ï¼Œé€™è£¡å¡«æª”åå°±å¥½
    const playlist = [
      "/media/demo.mp4",
      "/media/demo2.mp4"
    ];
    let vidIndex = 0;

    function showFallback(on){
      if (!mediaFallback) return;
      mediaFallback.style.display = on ? "flex" : "none";
    }

    function loadVideo(src, autoplay=true){
      if (!bgVideo) return;
      bgVideo.src = src;
      bgVideo.loop = true;         // æ´»å‹•æœ€ç©©ï¼šå¾ªç’°æ’­æ”¾ï¼ˆä½ ä¹Ÿå¯æ”¹ falseï¼‰
      bgVideo.muted = true;        // é è¨­éœéŸ³ï¼Œé¿å…ç¾å ´çˆ†éŸ³
      bgVideo.playsInline = true;

      bgVideo.onloadeddata = () => {
        showFallback(false);
        if (autoplay) bgVideo.play().catch(() => {});
      };
      bgVideo.onerror = () => {
        // æ‰¾ä¸åˆ°å½±ç‰‡æˆ–æ ¼å¼ä¸æ”¯æ´ â†’ é¡¯ç¤ºå°é¢
        showFallback(true);
      };
    }

    if (hasMedia && mediaSlot) {
      mediaSlot.style.display = "block";

      // è‹¥ä½ é‚„æ²’æ”¾å½±ç‰‡æª”ï¼Œæœƒé¡¯ç¤ºå°é¢
      showFallback(true);
      loadVideo(playlist[vidIndex], true);

      // å½±ç‰‡æ’­å®Œï¼ˆè‹¥ä½ æŠŠ loop æ”¹æˆ falseï¼‰â†’ é¡¯ç¤ºå°é¢ï¼ˆé¸é … Bï¼‰
      bgVideo.addEventListener("ended", () => {
        showFallback(true);
      });
    }

    // ===== ä¸»æŒäººå½±ç‰‡æ§åˆ¶ï¼ˆåªç¶ hostï¼‰=====
    const vidPlay = document.getElementById("vidPlay");
    const vidPause = document.getElementById("vidPause");
    const vidMute = document.getElementById("vidMute");
    const vidNext = document.getElementById("vidNext");

    function nextVideo(){
      vidIndex = (vidIndex + 1) % playlist.length;
      loadVideo(playlist[vidIndex], true);
    }

    if (isHost && bgVideo) {
      if (vidPlay)  vidPlay.addEventListener("click", () => bgVideo.play().catch(()=>{}));
      if (vidPause) vidPause.addEventListener("click", () => bgVideo.pause());
      if (vidMute)  vidMute.addEventListener("click", () => {
        bgVideo.muted = !bgVideo.muted;
        vidMute.textContent = bgVideo.muted ? "ğŸ”‡ éœéŸ³" : "ğŸ”Š æœ‰è²";
      });
      if (vidNext)  vidNext.addEventListener("click", nextVideo);
    }
  </script>
</body>
</html>
